<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>红包管理平台</title>
  <!--webkit去掉滚动条-->
  <style>

    ::-webkit-scrollbar {
      width: 0 !important;
    }
    ::-webkit-scrollbar {
      width: 0 !important;height: 0;
    }
    .el-menu{
      border:0!important;
    }
  </style>

</head>
<body>

<script src="../js/vue.js"></script>
<script src="../element-ui/lib/index.js"></script>
<link rel="stylesheet" href="../element-ui/lib/theme-chalk/index.css">

<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>

<style>
  html,body{height: 100%;margin: 0}

  a{TEXT-DECORATION:none}


  .right {
    /*float: left;*/
    width: 100%;
    margin-left: 20px;
  }
</style>

<div id="app" class="right">

  <!--搜索表单-->


  <!--按钮-->

  <el-row>

    <el-button type="danger" plain @click="deleteByIds">批量删除</el-button>
    <el-button type="primary" plain @click="dialogVisible = true">新增</el-button>

  </el-row>
  <!--添加数据对话框表单-->
  <el-dialog
          title="添加学生信息"
          :visible.sync="dialogVisible"
          width="30%"
  >

    <el-form ref="form" :model="brandSec" label-width="80px">
      <el-form-item label="学生姓名">
        <el-input v-model="brandSec.brandName"></el-input>
      </el-form-item>

      <el-form-item label="性别">
        <el-input v-model="brandSec.companyName"></el-input>
      </el-form-item>

      <el-form-item label="年龄">
        <el-input v-model="brandSec.ordered"></el-input>
      </el-form-item>

      <el-form-item label="班级">
        <el-input v-model="brandSec.status"
        ></el-input>
      </el-form-item>

      <el-form-item label="备注">
        <el-input type="textarea" v-model="brandSec.description"></el-input>
      </el-form-item>

      <el-form-item>
        <el-button type="primary" plain @click="addBrand">提交</el-button>
        <el-button @click="dialogVisible = false">取消</el-button>
      </el-form-item>
    </el-form>

  </el-dialog>


  <!--表格-->
  <template>
    <el-table
            :data="tableData"
            style="width: 80%"
            :row-class-name="tableRowClassName"
            @selection-change="handleSelectionChange"
    >
      <el-table-column
              type="selection"
              width="55">
      </el-table-column>
      <el-table-column
              type="index"
              width="50">
      </el-table-column>

      <el-table-column
              prop="brandName"
              label="学生姓名"
              align="center"
      >
      </el-table-column>
      <el-table-column
              prop="companyName"
              label="性别"
              align="center"
      >
      </el-table-column>
      <el-table-column
              prop="ordered"
              align="center"
              label="年龄">
      </el-table-column>
      <el-table-column
              prop="status"
              align="center"
              label="班级">
      </el-table-column>

      <el-table-column
              align="center"
              label="操作">
        <template slot-scope="scope">
          <el-button type="primary"  @click="updateById(scope.$index, scope.row)">修改</el-button>
          <el-button type="danger"  @click="deleteById(scope.$index, scope.row)">删除</el-button>
          <!--修改数据对话框表单-->
          <el-dialog
                  title="修改"
                  :visible.sync="addVisible"
                  width="30%"
          >
            <el-form ref="form" :model="brand" label-width="80px">
              <el-form-item label="学生姓名">
                <el-input v-model="brandThd.brandName"></el-input>
              </el-form-item>

              <el-form-item label="性别">
                <el-input v-model="brandThd.companyName"></el-input>
              </el-form-item>

              <el-form-item label="年龄">
                <el-input v-model="brandThd.ordered"></el-input>
              </el-form-item>

              <el-form-item label="班级">
                <el-input v-model="brandThd.status"
                ></el-input>
              </el-form-item>

              <el-form-item label="备注">
                <!--                                <el-input type="textarea" v-model="brand.description"></el-input>-->
                <el-input v-model="brandThd.description"></el-input>
              </el-form-item>

              <el-form-item>
                <el-button type="primary" @click="updatebrand">提交</el-button>
                <el-button @click="addVisible = false">取消</el-button>
              </el-form-item>
            </el-form>
          </el-dialog>

        </template>

      </el-table-column>

    </el-table>
  </template>



  <!--分页工具条-->
  <el-pagination
          @size-change="handleSizeChange"
          @current-change="handleCurrentChange"
          :current-page="currentPage"
          :page-sizes="[5, 10, 15, 20]"
          :page-size="5"
          layout="total, sizes, prev, pager, next, jumper"
          :total="totalCount">
  </el-pagination>

</div>



<script>
  var shiyixiashuzi = 'tb_brand';

  function gaiyixia(val){
    shiyixiashuzi = val;
    //无法在axios使用this，所以在axios外定义了一个
    var _this = this;
    // console.log("aabb"+_this.brand.tablename);
    //页面加载完后发送异步请求，获取数据
    axios({
      method:"post",
      url:"http://localhost:8081/brand-case/tableChange",
      data:shiyixiashuzi
    })
  }

  new Vue({
    el:"#app2",

    methods:{


      handleOpen(key, keyPath) {
        console.log(key, keyPath);
      },
      handleClose(key, keyPath) {
        console.log(key, keyPath);
      }


    },

    data() {
      return {
        activeIndex: 2,
        activeIndex2: 2,

        pageSize:5,
        currentPage:1,

        totalCount:100,

        // table_name: 1,

        rows:[],

        brand: {
          status: '',
          brandName: '',
          companyName: '',
          id:"",
          ordered:"",
          ordered2:"",
          description:""
        },
      };
    }
  })
</script>



<script>



  new Vue({

    el: "#app",

    mounted(){

      this.selectALL();

    },



    methods: {

      selectALL() {
        //无法在axios使用this，所以在axios外定义了一个
        var _this = this;
        num = 1;
        // console.log("aabb"+_this.brand.tablename);
        //页面加载完后发送异步请求，获取数据
        axios({
          method:"post",
          url:"http://localhost:8081/brand-case/selectByPageAndCondition?currentPage="+this.currentPage+"&pageSize="+this.pageSize,
          data:_this.brand
        }).then(resp =>{
          //设置表格数据
          _this.tableData = resp.data.rows; // {rows:[],totalCount:100}
          //设置总记录数
          _this.totalCount = resp.data.totalCount;

        })
      },


      tableRowClassName({row, rowIndex}) {
        if (rowIndex === 1) {
          return 'warning-row';
        } else if (rowIndex === 3) {
          return 'success-row';
        }
        return '';
      },

      // 复选框选中后执行的方法
      handleSelectionChange(val) {
        this.multipleSelection = val;
      },

      // 查询方法
      onSubmit() {
        this.selectALL();
      },

      // 添加数据
      addBrand(){
        //console.log(this.brand);
        //发送ajax请求，添加数据
        var _this = this;
        axios({
          method: "post",
          url:"http://localhost:8081/brand-case/addServlet",
          data: _this.brandSec
        }).then(function (response) {
          if (response.data == "success"){
            _this.selectALL();
            //关闭窗口
            _this.dialogVisible = false;

            _this.$message({
              message:'添加成功!',
              type:'success'
            });
          }else {
            _this.$message.error('添加失败');
          }
        })
      },

      updateById(index, row) {
        var _this = this;
        _this.brand.id = row.id;
        _this.addVisible = true;
      },
      //修改数据
      updatebrand(){
        var _this = this;
        //发送ajax异步请求，添加数据
        axios({
          method: "post",
          url: "http://localhost:8081/brand-case/updateServlet",
          data: _this.brandThd
        }).then(function (resp) {
          if (resp.data == "success") {
            //关闭窗口
            _this.addVisible = false;
            //查询一次
            _this.selectALL();
            _this.$message({
              message: '修改成功',
              type: 'success'
            });
          } else {
            _this.$message.error('修改数据失败');
          }
        })
      },

      //删除数据
      deleteById(index, row) {
        var _this = this;
        this.$confirm('此操作将删除该数据, 是否继续?', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          // 发送ajax请求，添加数据
          axios({
            method: "get",
            url: "http://localhost:8081/brand-case/deleteServlet",
            data: row.id
          }).then(function (resp) {
            if (resp.data == "success") {
              // 重新查询数据
              _this.selectALL();
              // 弹出消息提示
              _this.$message({
                message: '删除成功',
                type: 'success'
              });
            }
          })
        }).catch(() => {
          //用户点击取消按钮
          this.$message({
            type: 'info',
            message: '已取消删除'
          });
        });
      },


      //批量删除的方法
      deleteByIds(){
        //1.创建id数组
        for (let i = 0; i < this.multipleSelection.length; i++) {
          let selectionElement = this.multipleSelection[i];
          this.selectedIds[i] = selectionElement.id;
        }
        var _this = this;

        _this.$confirm('该操作不可逆，是否确定要删除已选择的数据?', '警告', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          //确定

          //发送ajax请求
          axios({
            method: "post",
            url: "http://localhost:8081/brand-case/deleteByIdsServlet",
            data: _this.selectedIds
          }).then(function (resp) {
            if (resp.data == "success") {
              //关闭窗口
              _this.addVisible = false;
              //查询一次
              _this.selectALL();
              _this.$message({
                message: '删除成功',
                type: 'success'
              });
            } else {
              _this.$message.error('删除失败');
            }
          });
        }).catch(() => {
          //取消
          _this.$message({
            type: 'info',
            message: '已取消删除'
          });
        });

      },

      //分页
      handleSizeChange(val) {
        this.pageSize  = val;
        this.selectALL();
      },
      handleCurrentChange(val) {
        this.currentPage  = val;
        this.selectALL();
      },

      handleSelect(key, keyPath) {
        console.log(key, keyPath);
      }

    },

    handleOpen(key, keyPath) {
      console.log(key, keyPath);
    },
    handleClose(key, keyPath) {
      console.log(key, keyPath);
    },

    data() {
      return {
        cup:1,
        toc:1,

        activeIndex: '1',
        activeIndex2:'2',
        pageSize:5,

        totalCount:100,

        addVisible: false,
        // 当前页码
        currentPage: 1,

        // 添加数据对话框是否展示的标记
        dialogVisible: false,

        rows:[],
        rowsSec:[],

        // tablename:"tb_brand",

        // 品牌模型数据
        brand: {
          status: '',
          brandName: '',
          companyName: '',
          id:"",
          ordered:"",
          ordered2:"",
          description:""
        },

        // 品牌模型数据
        brandSec: {
          status: '',
          brandName: '',
          companyName: '',
          id:"",
          ordered:"",
          ordered2:"",
          description:""
        },

        // 品牌模型数据
        brandThd: {
          status: '',
          brandName: '',
          companyName: '',
          id:"",
          ordered:"",
          ordered2:"",
          description:""
        },

        //批量删除中被选中的id数组
        selectedIds:[],
        // 复选框选中数据集合
        multipleSelection: [],
        // 表格数据
        tableData: [{
          brandName: '华为',
          companyName: '华为科技有限公司',
          ordered: '100',
          status: "1"
        }, {
          brandName: '华为',
          companyName: '华为科技有限公司',
          ordered: '100',
          status: "1"
        }, {
          brandName: '华为',
          companyName: '华为科技有限公司',
          ordered: '100',
          status: "1"
        }, {
          brandName: '华为',
          companyName: '华为科技有限公司',
          ordered: '100',
          status: "1"
        }]
      }
    }
  })

</script>

</body>
</html>